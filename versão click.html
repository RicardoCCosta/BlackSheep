<canvas id="ctx" width="900" height="800" style="border:1px solid #000000;"></canvas>
<button onclick="paused = !paused;">Pause</button>
<script>
var ctx = document.getElementById("ctx").getContext("2d");
ctx.font = '30px Economica';

var Width = 900;
var Height = 800;
var start = Date.now();
var score = 0;
var dog;
var wolf;
var sheepDicio = {};
var num_sheep = 0;
var paused = false;

//colocar imagens nos animais
var Img = {};
Img.dog = new Image();
Img.dog.src = "Imagens/cao.png";
Img.wolf = new Image();
Img.wolf.src = "Imagens/cao.png";
Img.sheep = new Image();
Img.sheep.src = "Imagens/ovelha.png";
Img.map = new Image();
Img.map.src = "Imagens/fundo.png";

Animal = function(type,key,posX,posY,width,height,image,spdX,spdY){
	var self = {
		type:type,
		key:key,
	    posX:posX,
	    posY:posY,
	    width:width,
	    height:height,
	    image:image,
	    spdX:spdX,
	    spdY:spdY,
	}

  	self.draw = function(){
		ctx.save();
		var posX = self.posX - self.width/2;
		var posY = self.posY - self.height/2;
		ctx.drawImage(self.image,0,0,self.image.width,self.image.height,posX,posY,self.width,self.height);
		ctx.restore();
	}

	self.distAnimal = function(animal){
		var x = self.posX - animal.posX;
		var y = self.posY - animal.posY;
		return Math.sqrt(x*x+y*y);
	}

	self.collision = function(animal){
		var an = {
			posX:self.posX-self.width/2,
			posY:self.posY-self.height/2,
			width:self.width,
			height:self.height,
		}
		var an2 = {
			posX:animal.posX-animal.width/2,
			posY:animal.posY-animal.height/2,
			width:animal.width,
			height:animal.height,
		}
		return an.posX <= an2.posX+an2.width && an2.posX <= an.posX+an.width
		&& an.posY <= an2.posY + an2.height && an2.posY <= an.posY + an.height;
		
	}
	
	return self;
}

Dog = function(){
    var self = Animal('dog','player',100,140,60,60,Img.dog,10,10);
       
    self.move = function(){
        if(self.rightKey)
    		self.x += self.spdX;
        if(self.leftKey)
            self.x -= self.spdX;   
        if(self.upKey)
            self.y -= self.spdY;
        if(self.downKey)
            self.y += self.spdY;   
       	
       	//limites do mapa
        if(self.x < self.width/2)
            self.x = self.width/2;
        if(self.x > Width-self.width/2)
            self.x = Width - self.width/2;
        if(self.y < self.height/2)
            self.y = self.height/2;
        if(self.y > Height - self.height/2)
            self.y = Height - self.height/2;

        self.draw();
    }
       
    self.rightKey = false;
    self.leftKey = false;
    self.upKey = false;
    self.downKey = false;
    return self;
       
}

Sheep = function(){
	
    num_sheep++;
	var self = Animal('sheep',num_sheep,Math.random()*Width,Math.random()*Height,60,60,Img.sheep,5,5);
	sheepDicio[num_sheep] = self;

    self.move = function(){
    	self.posX += self.spdX;
    	self.posY += self.spdY;
        
        if(self.posX < 0 || self.posX > Width)
        	self.spdX=-self.spdX;
        if(self.posY < 0 || self.posY > Height)
        	self.spdY=-self.spdY;
        self.draw();      
    }
}

document.onclick = function(mouse){
	var mouseX = mouse.clientX;
	var mouseY = mouse.clientY;
	dog.posX = mouseX;
	dog.posY = mouseY;
}

emptyDicio = function(dicio){
	for(var key in dicio)
		return false;
	return true;
}

update = function(){
    if(paused)
        return;
   
    ctx.clearRect(0,0,Width,Height);
    drawMap();
    score++;
    dog.move();

    for(var key in sheepDicio){
        sheepDicio[key].move();
        var collide = wolf.collision(sheepDicio[key]);
        if(collide){
        	delete sheepDicio[key];
        }
    }
    
    if(emptyDicio(sheepDicio)){           
        console.log("You lost! Your score was "+score+"!");            
        startGame();
    }
    
    ctx.fillText('Score: ' + score,200,30);
}

drawMap = function(){
	ctx.drawImage(Img.map,0,0,Img.map.width,Img.map.height,0,0,900,800);
}

startGame = function(){
        score = 0;
        sheepDicio = {};
        Sheep();
        Sheep();
        Sheep();
        Sheep();
}
 
dog = Dog();
wolf = Dog();
startGame();
 
setInterval(update,40);
 
</script>
